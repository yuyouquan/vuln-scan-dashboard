<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="60">
    <title>ğŸ›¡ï¸ æ¼æ´æ‰«æçœ‹æ¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'SF Mono', 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; min-height: 100vh; }
        
        .header { background: linear-gradient(180deg, #161b22 0%, #0d1117 100%); padding: 20px 30px; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: #58a9ff; font-size: 22px; font-weight: 600; }
        .header .time { color: #8b949e; font-size: 13px; }
        
        .toolbar { padding: 15px 30px; background: #161b22; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .search-box { display: flex; align-items: center; gap: 10px; }
        .search-box input { background: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 8px 12px; color: #c9d1d9; font-size: 13px; width: 200px; }
        .search-box input:focus { outline: none; border-color: #58a9ff; }
        .filter-btns { display: flex; gap: 8px; }
        .filter-btn { padding: 6px 14px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .filter-btn:hover, .filter-btn.active { background: #238636; border-color: #3fb950; color: #fff; }
        
        .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; background: #30363d; }
        .stat { background: #161b22; padding: 15px 20px; text-align: center; }
        .stat-value { font-size: 28px; font-weight: 700; color: #58a9ff; }
        .stat-label { font-size: 11px; margin-top: 4px; color: #8b949e; text-transform: uppercase; }
        
        .pagination-bar { padding: 15px 30px; background: #161b22; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        .page-info { color: #8b949e; font-size: 13px; }
        .page-size select { background: #21262d; border: 1px solid #30363d; border-radius: 6px; padding: 6px 10px; color: #c9d1d9; font-size: 12px; cursor: pointer; }
        
        .targets-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; padding: 24px; }
        
        .target-card { background: #161b22; border: 1px solid #30363d; border-radius: 10px; overflow: hidden; transition: all 0.25s; cursor: pointer; }
        .target-card:hover { border-color: #58a9ff; transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
        .target-card.hidden { display: none; }
        .target-card.scanning { border-left: 4px solid #3fb950; }
        .target-card.done { border-left: 4px solid #58a9ff; }
        .target-card.waiting { border-left: 4px solid #f0883e; }
        
        .card-header { padding: 16px; background: #21262d; display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 15px; font-weight: 600; color: #58a9ff; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 500; }
        .status-badge.scanning { background: #238636; color: #fff; }
        .status-badge.done { background: #58a9ff; color: #fff; }
        .status-badge.waiting { background: #f0883e; color: #000; }
        
        .card-body { padding: 16px; }
        .progress-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .progress-label { font-size: 12px; color: #8b949e; }
        .progress-value { font-size: 14px; font-weight: 700; color: #3fb950; }
        .progress-bar { height: 8px; background: #30363d; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #3fb950, #58a9ff); border-radius: 4px; transition: width 0.5s ease; }
        
        .target-count { margin-top: 12px; font-size: 12px; color: #8b949e; }
        
        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9999; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: #161b22; border: 1px solid #30363d; border-radius: 14px; width: 95%; max-width: 800px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 20px 24px; background: #21262d; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 18px; font-weight: 600; color: #58a9ff; }
        .modal-close { font-size: 28px; color: #8b949e; cursor: pointer; line-height: 1; }
        .modal-close:hover { color: #fff; }
        .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
        
        .modal-progress { margin-bottom: 24px; }
        .modal-progress .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .modal-progress .label { color: #8b949e; }
        .modal-progress .value { font-weight: 600; }
        .modal-progress .bar { height: 10px; background: #30363d; border-radius: 5px; overflow: hidden; }
        .modal-progress .fill { height: 100%; background: linear-gradient(90deg, #3fb950, #58a9ff); }
        
        .sub-targets { margin-top: 20px; }
        .sub-targets h3 { font-size: 14px; color: #8b949e; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .sub-target { background: #0d1117; border-radius: 8px; margin-bottom: 12px; overflow: hidden; }
        .sub-header { padding: 12px 16px; background: #21262d; display: flex; justify-content: space-between; align-items: center; }
        .sub-url { font-size: 13px; color: #c9d1d9; font-weight: 500; }
        .sub-tools-count { font-size: 11px; color: #8b949e; }
        
        .tools-list { padding: 12px 16px; }
        
        .tool-item { background: #161b22; border-radius: 6px; margin-bottom: 8px; padding: 12px; }
        .tool-item:last-child { margin-bottom: 0; }
        .tool-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .tool-name { padding: 3px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .tool-strix { background: #238636; color: #fff; }
        .tool-nikto { background: #f0883e; color: #000; }
        .tool-nmap { background: #58a9ff; color: #fff; }
        .tool-status { margin-left: auto; font-size: 11px; padding: 3px 8px; border-radius: 10px; }
        .tool-status.scanning { background: #238636; color: #fff; }
        .tool-status.done { background: #58a9ff; color: #fff; }
        .tool-status.waiting { background: #f0883e; color: #000; }
        
        .tool-progress-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .tool-progress-bar { flex: 1; height: 5px; background: #30363d; border-radius: 3px; }
        .tool-progress-fill { height: 100%; background: #3fb950; border-radius: 3px; }
        .tool-progress-num { font-size: 12px; color: #3fb950; font-weight: 600; min-width: 40px; text-align: right; }
        
        .tool-detail { background: #0d1117; border-radius: 4px; padding: 10px; font-size: 12px; }
        .detail-row { display: flex; gap: 10px; margin-bottom: 5px; }
        .detail-row:last-child { margin-bottom: 0; }
        .detail-row .label { color: #8b949e; min-width: 70px; }
        .detail-row .value { color: #c9d1d9; }
        .detail-row .highlight { color: #f0883e; font-weight: 600; }
        
        .pagination { display: flex; justify-content: center; gap: 8px; padding: 20px; }
        .page-btn { padding: 8px 14px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-size: 13px; cursor: pointer; }
        .page-btn:hover, .page-btn.active { background: #238636; border-color: #3fb950; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #8b949e; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ›¡ï¸ æ¼æ´æ‰«æçœ‹æ¿</h1>
        <span class="time">2026-02-22 10:43:40</span>
    </div>
    
    <div class="toolbar">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="æœç´¢é¡¹ç›®åç§°..." oninput="filterProjects()">
        </div>
        <div class="filter-btns">
            <button class="filter-btn active" onclick="setFilter('all')">å…¨éƒ¨</button>
            <button class="filter-btn" onclick="setFilter('scanning')">æ‰«æä¸­</button>
            <button class="filter-btn" onclick="setFilter('done')">å·²å®Œæˆ</button>
            <button class="filter-btn" onclick="setFilter('waiting')">ç­‰å¾…ä¸­</button>
        </div>
    </div>
    
    <div class="stats-bar">
        <div class="stat"><div class="stat-value">0</div><div class="stat-label">æ€»è¿›ç¨‹</div></div>
        <div class="stat"><div class="stat-value">0</div><div class="stat-label">Strix</div></div>
        <div class="stat"><div class="stat-value">0</div><div class="stat-label">Nikto</div></div>
        <div class="stat"><div class="stat-value">0</div><div class="stat-label">Nmap</div></div>
    </div>
    
    <div class="pagination-bar">
        <span class="page-info" id="pageInfo">å…± 1 ä¸ªé¡¹ç›®</span>
        <div class="page-size">
            æ¯é¡µæ˜¾ç¤º: <select id="pageSize" onchange="changePageSize()">
                <option value="8" selected>8 æ¡</option>
                <option value="16">16 æ¡</option>
                <option value="32">32 æ¡</option>
            </select>
        </div>
    </div>
    
    <div class="targets-grid" id="targetsGrid"></div>
    
    <div class="pagination" id="pagination"></div>
    
    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">é¡¹ç›®è¯¦æƒ…</span>
                <span class="modal-close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        const projectsData = [{"index": 0, "name": "Tripadvisor", "status": "scanning", "progress": 63, "statusText": "æ‰«æä¸­", "statusCls": "scanning"}];
        
        let currentPage = 1;
        let pageSize = 8;
        let currentFilter = 'all';
        let searchTerm = '';
        
        function renderProjects() {
            const grid = document.getElementById('targetsGrid');
            const filtered = projectsData.filter(p => {
                const matchFilter = currentFilter === 'all' || p.status === currentFilter;
                const matchSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
                return matchFilter && matchSearch;
            });
            
            const total = filtered.length;
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = filtered.slice(start, end);
            
            if (pageData.length === 0) {
                grid.innerHTML = '<div class="empty-state">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¡¹ç›®</div>';
                document.getElementById('pageInfo').textContent = 'å…± 0 ä¸ªé¡¹ç›®';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            grid.innerHTML = pageData.map(p => `
                <div class="target-card ${p.statusCls}" onclick="openModal(${p.index})">
                    <div class="card-header">
                        <span class="card-title">${p.name}</span>
                        <span class="status-badge ${p.statusCls}">${p.statusText}</span>
                    </div>
                    <div class="card-body">
                        <div class="progress-row">
                            <span class="progress-label">è¿›åº¦</span>
                            <span class="progress-value">${p.progress}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${p.progress}%"></div>
                        </div>
                        <div class="target-count">æ‰«æç›®æ ‡: ${getTargetCount(p.index)} ä¸ª</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('pageInfo').textContent = `ç¬¬ ${currentPage} / ${Math.ceil(total/pageSize)} é¡µï¼Œå…± ${total} ä¸ªé¡¹ç›®`;
            renderPagination(Math.ceil(total / pageSize));
        }
        
        function getTargetCount(index) {
            const p = projectsData.find(p => p.index === index);
            return p ? 1 : 0;
        }
        
        function renderPagination(totalPages) {
            const pag = document.getElementById('pagination');
            if (totalPages <= 1) { pag.innerHTML = ''; return; }
            
            let html = `<button class="page-btn" onclick="goPage(1)" ${currentPage === 1 ? 'disabled' : ''}>é¦–é¡µ</button>`;
            html += `<button class="page-btn" onclick="goPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;
            
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goPage(${i})">${i}</button>`;
            }
            
            html += `<button class="page-btn" onclick="goPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
            html += `<button class="page-btn" onclick="goPage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}>æœ«é¡µ</button>`;
            
            pag.innerHTML = html;
        }
        
        function goPage(page) {
            currentPage = page;
            renderProjects();
        }
        
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            renderProjects();
        }
        
        function setFilter(filter) {
            currentFilter = filter;
            currentPage = 1;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderProjects();
        }
        
        function filterProjects() {
            searchTerm = document.getElementById('searchInput').value;
            currentPage = 1;
            renderProjects();
        }
        
        function openModal(index) {
            const p = projectsData.find(p => p.index === index);
            if (!p) return;
            
            document.getElementById('modalTitle').textContent = p.name;
            
            // è·å–å®Œæ•´é¡¹ç›®æ•°æ®
            const fullData = [{"name": "Tripadvisor", "status": "scanning", "progress": 63, "targets": [{"name": "www.tripadvisor.com", "tools": [{"name": "Strix", "status": "scanning", "progress": 50, "scanned": 2100, "found": 5, "endpoints": ["/api/", "/hotels", "/flights", "/reviews", "/search"]}, {"name": "Nikto", "status": "scanning", "progress": 40, "scanned": 45, "found": 2, "vulns": ["X-Frame-Options missing", "Server-Leaks-Information via X-Powered-By"]}, {"name": "Nmap", "status": "completed", "progress": 100, "scanned": 1000, "found": 5, "ports": [80, 443, 8080, 8443, 22]}]}], "last_updated": "2026-02-22T10:39:53.129319"}];
            const fullProject = fullData.projects.find(proj => proj.name === p.name);
            
            let modalHtml = `
                <div class="modal-progress">
                    <div class="row">
                        <span class="label">çŠ¶æ€</span>
                        <span class="status-badge ${p.statusCls}">${p.statusText}</span>
                    </div>
                    <div class="row">
                        <span class="label">è¿›åº¦</span>
                        <span class="value" style="color:#3fb950">${p.progress}%</span>
                    </div>
                    <div class="bar"><div class="fill" style="width:${p.progress}%"></div></div>
                </div>
            `;
            
            if (fullProject && fullProject.targets) {
                modalHtml += '<div class="sub-targets"><h3>æ‰«æç›®æ ‡</h3>';
                
                fullProject.targets.forEach(t => {
                    modalHtml += `<div class="sub-target">
                        <div class="sub-header">
                            <span class="sub-url">ğŸ“ ${t.name}</span>
                            <span class="sub-tools-count">${t.tools.length} ä¸ªå·¥å…·</span>
                        </div>
                        <div class="tools-list">`;
                    
                    t.tools.forEach(tool => {
                        let detail = '';
                        if (tool.name === 'Strix') {
                            const eps = tool.endpoints ? tool.endpoints.slice(0, 5).join(', ') : 'æ— ';
                            detail = `<div class="detail-row"><span class="label">å·²æ‰«æ:</span><span class="value">${tool.scanned} URL</span></div>
                                <div class="detail-row"><span class="label">å‘ç°ç«¯ç‚¹:</span><span class="value highlight">${tool.found}</span></div>
                                <div class="detail-row"><span class="label">ç«¯ç‚¹åˆ—è¡¨:</span><span class="value">${eps}</span></div>`;
                        } else if (tool.name === 'Nikto') {
                            const vulns = tool.vulns ? tool.vulns.join(', ') : 'æ— ';
                            detail = `<div class="detail-row"><span class="label">å·²æ‰«æ:</span><span class="value">${tool.scanned} é¡¹</span></div>
                                <div class="detail-row"><span class="label">å‘ç°é—®é¢˜:</span><span class="value highlight">${tool.found}</span></div>
                                <div class="detail-row"><span class="label">é—®é¢˜:</span><span class="value">${vulns}</span></div>`;
                        } else {
                            const ports = tool.ports ? tool.ports.join(', ') : 'ç­‰å¾…';
                            detail = `<div class="detail-row"><span class="label">å·²æ‰«æ:</span><span class="value">${tool.scanned} IP</span></div>
                                <div class="detail-row"><span class="label">å¼€æ”¾ç«¯å£:</span><span class="value highlight">${tool.found}</span></div>
                                <div class="detail-row"><span class="label">ç«¯å£:</span><span class="value">${ports}</span></div>`;
                        }
                        
                        const statusText = {'scanning': 'æ‰«æä¸­', 'done': 'å·²å®Œæˆ', 'waiting': 'ç­‰å¾…ä¸­'}[tool.status] || 'æœªçŸ¥';
                        modalHtml += `<div class="tool-item">
                            <div class="tool-header">
                                <span class="tool-name tool-${tool.name.toLowerCase()}">${tool.name}</span>
                                <span class="tool-status ${tool.status}">${statusText}</span>
                            </div>
                            <div class="tool-progress-row">
                                <div class="tool-progress-bar"><div class="tool-progress-fill" style="width:${tool.progress}%"></div></div>
                                <span class="tool-progress-num">${tool.progress}%</span>
                            </div>
                            <div class="tool-detail">${detail}</div>
                        </div>`;
                    });
                    
                    modalHtml += '</div></div>';
                });
                
                modalHtml += '</div>';
            }
            
            document.getElementById('modalBody').innerHTML = modalHtml;
            document.getElementById('modalOverlay').classList.add('show');
        }
        
        function closeModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('modalOverlay').classList.remove('show');
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
        
        // åˆå§‹åŒ–
        renderProjects();
    </script>
</body>
</html>